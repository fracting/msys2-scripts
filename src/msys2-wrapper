#!/bin/sh

set -e
set -x

. /etc/msys2-env

command=$*

export MSYSTEM=MSYS
export WINEDEBUG=fixme-all

if test -d ${MSYS_ROOT}${HOME}
then
    cd ${MSYS_ROOT}${HOME}
fi

SCRIPT_FILE=typescript
EXIT_CODE=exit_code
rm -f ${SCRIPT_FILE}
rm -f ${EXIT_CODE}

(wineconsole $MSYS_ROOT/usr/bin/script.exe -q -f -e -c "/usr/bin/bash.exe -l -x -e -c \"$command\"" || echo $? > ${EXIT_CODE})&
tail -F ${SCRIPT_FILE} --pid=$!|| return 0

if test -f ${EXIT_CODE}
then
    exit $(cat ${EXIT_CODE})
fi
